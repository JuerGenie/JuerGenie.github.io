---
import { Image } from "@astrojs/image/components";

type ImageProps = Parameters<typeof Image>[0];
export type Props = Partial<ImageProps> & {
  href: string;
};

const { href, ...props } = Astro.props as Props;

const assets = await Astro.glob("../assets/**/*");
const target = href.startsWith("http")
  ? href
  : assets.find((asset) => {
      if (!href) {
        return false;
      }
      if (!asset.default?.src) {
        return false;
      }
      const index = asset.default.src.indexOf("/assets/");
      return asset.default.src.slice(index) === href;
    }) ?? href;
---

<Image src={typeof target === "string" ? target : target.default} {...props} />
